-- Drop old check constraint and add new one with additional types
ALTER TABLE public.legal_documents DROP CONSTRAINT legal_documents_type_check;

ALTER TABLE public.legal_documents 
ADD CONSTRAINT legal_documents_type_check 
CHECK (type = ANY (ARRAY['terms'::text, 'privacy'::text, 'data_processing'::text, 'public_offer'::text, 'help_support'::text]));

-- Update existing documents with summary/full content
UPDATE public.legal_documents 
SET content = '## Краткое описание

Настоящие Условия использования регулируют порядок использования приложения TopFocus.

**Основные положения:**
- Приложение предоставляется "как есть" для личного использования
- Пользователь несёт ответственность за сохранность своих данных
- Запрещено использование приложения в противоправных целях
- Мы оставляем за собой право изменять условия с уведомлением пользователей

**Ваши права:**
- Бесплатный доступ к базовому функционалу
- Защита персональных данных
- Удаление аккаунта и данных по запросу

Полная версия документа доступна по запросу.',
version = version + 1,
updated_at = now()
WHERE type = 'terms';

UPDATE public.legal_documents 
SET content = '## Краткое описание

Мы заботимся о конфиденциальности ваших данных.

**Какие данные мы собираем:**
- Email для авторизации
- Данные о задачах, привычках и финансах (хранятся локально и в облаке)
- Статистика использования приложения

**Как мы используем данные:**
- Для предоставления функционала приложения
- Для улучшения качества сервиса
- Для отправки уведомлений (с вашего согласия)

**Ваши права:**
- Доступ к своим данным
- Исправление и удаление данных
- Отзыв согласия на обработку

Мы не передаём ваши данные третьим лицам без вашего согласия.
  
  Полная версия документа доступна по запросу.',
version = version + 1,
updated_at = now()
WHERE type = 'privacy';

UPDATE public.legal_documents 
SET content = '## Политика обработки персональных данных

### 1. Общие положения

1.1. Настоящая Политика определяет порядок обработки персональных данных пользователей приложения TopFocus.

1.2. Оператор обработки персональных данных — владелец приложения TopFocus.

### 2. Цели обработки персональных данных

2.1. Персональные данные обрабатываются в следующих целях:
- Предоставление доступа к функционалу приложения
- Идентификация пользователя в системе
- Обеспечение синхронизации данных между устройствами
- Отправка уведомлений и напоминаний
- Улучшение качества предоставляемых услуг
- Выполнение требований законодательства

### 3. Состав обрабатываемых персональных данных

3.1. Мы обрабатываем следующие категории данных:
- Идентификационные данные (email, имя пользователя)
- Данные об использовании приложения (задачи, привычки, финансовые записи)
- Технические данные (IP-адрес, тип устройства, версия ОС)
- Данные о настройках и предпочтениях пользователя

### 4. Правовые основания обработки

4.1. Обработка осуществляется на основании:
- Согласия субъекта персональных данных
- Исполнения договора с пользователем
- Законных интересов оператора

### 5. Права субъекта персональных данных

5.1. Вы имеете право:
- Получить информацию об обработке ваших данных
- Требовать уточнения, блокирования или уничтожения данных
- Отозвать согласие на обработку
- Обжаловать действия оператора в уполномоченный орган

### 6. Меры по защите персональных данных

6.1. Мы применяем следующие меры защиты:
- Шифрование данных при передаче и хранении
- Разграничение прав доступа
- Регулярное резервное копирование
- Мониторинг безопасности

### 7. Срок хранения данных

7.1. Персональные данные хранятся до момента удаления аккаунта пользователем или до отзыва согласия на обработку.

### 8. Контактная информация

8.1. По вопросам обработки персональных данных обращайтесь: support@top-focus.ru',
version = version + 1,
updated_at = now()
WHERE type = 'data_processing';

-- Insert public offer document
INSERT INTO public.legal_documents (type, title, content, version)
VALUES ('public_offer', 'Публичная оферта', '## Публичная оферта

### 1. Общие положения

1.1. Настоящий документ является официальным предложением (офертой) владельца приложения TopFocus заключить договор на использование приложения.

1.2. Акцептом (принятием) оферты является регистрация в приложении и начало его использования.

### 2. Предмет договора

2.1. Исполнитель предоставляет Пользователю доступ к мобильному приложению TopFocus для управления задачами, привычками и финансами.

2.2. Приложение предоставляется в двух тарифах:
- **Бесплатный тариф**: базовый функционал с ограничениями
- **Премиум тариф**: полный функционал без ограничений

### 3. Права и обязанности сторон

3.1. Исполнитель обязуется:
- Обеспечивать работоспособность приложения 24/7 (за исключением технических работ)
- Обеспечивать сохранность данных пользователя
- Своевременно уведомлять об изменениях в условиях использования

3.2. Пользователь обязуется:
- Соблюдать настоящие условия использования
- Не использовать приложение в противоправных целях
- Не передавать доступ к аккаунту третьим лицам

### 4. Стоимость услуг и порядок оплаты

4.1. Стоимость премиум-подписки указана в приложении и может изменяться.

4.2. Оплата производится через платёжные системы, интегрированные в приложение.

4.3. Возврат средств осуществляется в соответствии с правилами платформы (App Store / Google Play).

### 5. Ограничение ответственности

5.1. Приложение предоставляется "как есть" без гарантий пригодности для конкретных целей.

5.2. Исполнитель не несёт ответственности за:
- Потерю данных по вине пользователя
- Перерывы в работе, вызванные обстоятельствами непреодолимой силы
- Действия третьих лиц

### 6. Срок действия и расторжение

6.1. Договор действует с момента регистрации до удаления аккаунта.

6.2. Любая сторона может расторгнуть договор в одностороннем порядке.

### 7. Заключительные положения

7.1. Споры разрешаются путём переговоров или в судебном порядке.

7.2. Исполнитель вправе изменять условия оферты с уведомлением пользователей.', 1);

-- Insert help and support document
INSERT INTO public.legal_documents (type, title, content, version)
VALUES ('help_support', 'Помощь и поддержка', '## Помощь и поддержка

Мы всегда готовы помочь вам!

### Частые вопросы

**Как синхронизировать данные между устройствами?**
Войдите в один и тот же аккаунт на всех устройствах — данные синхронизируются автоматически.

**Как восстановить удалённые данные?**
К сожалению, удалённые данные восстановить нельзя. Рекомендуем регулярно экспортировать данные.

**Как отменить подписку?**
Управление подпиской осуществляется через настройки App Store или Google Play.

### Связаться с нами

- **Email**: support@top-focus.ru
- /**Telegram**: @topfocus_support**/
- **Время ответа**: до 24 часов в рабочие дни

### Сообщить об ошибке

Если вы обнаружили ошибку, опишите:
1. Что вы делали
2. Что ожидали увидеть
3. Что произошло на самом деле
4. Скриншот (если возможно)

Спасибо, что помогаете нам становиться лучше!', 1);